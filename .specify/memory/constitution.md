# upbit-auto 헌장

## 핵심 원칙

### I. 전략·백테스트 우선 (비교불가)
- 모든 자동매매 전략은 백테스트 합격 전에는 실거래 금지.
- 백테스트는 실거래와 동일 코드 경로를 사용하며 결정적(deterministic)이어야 함: 시드 고정, 데이터 스냅샷, 수수료/슬리피지 반영.
- 필수 성능 지표: 누적수익률, 최대낙폭(MDD), 샤프/소르티노(가능시), 승률, 기대값, 거래수, 비용(수수료·슬리피지).
- 기간 설계: 학습/최적화 구간과 검증(워크포워드) 구간을 분리.

### II. 라이브러리 우선 모듈화
- Python 라이브러리로 모듈 분리: core engine, data, strategy, broker(adapter), risk/position, reporting/logging.
- 각 모듈은 독립 테스트 가능하고 명확한 계약(인터페이스)을 가진다.
- 전략은 플러그인 형태로 등록/선택/파라미터화가 가능해야 한다.

### III. CLI 인터페이스
- 모든 기능은 CLI로 노출: 예) `ua fetch`, `ua backtest`, `ua trade`, `ua report`.
- 표준 I/O 규약: 입력은 인자/STDIN(JSON), 정상 결과는 STDOUT(JSON/사람친화), 오류는 STDERR + 적절한 종료코드.
- 설정은 기본값 + 설정파일(`.toml`/`.yaml`) + 환경변수 + CLI 플래그 계층 병합.

### IV. 안정성·리스크·실거래 안전장치
- 필수 제어: 포지션 사이즈 한도, 일간 손실 한도, 최대 동시 포지션 수, 중복 주문 방지, 재진입 쿨다운.
- 기본 모드는 페이퍼/드라이런; 실거래는 `--live` 명시 플래그와 2단계 확인이 필요.
- 실거래 실패 시 안전 정지(fail-safe) 및 상태 보존, 재시작 가능.

### V. 관측 가능성, 버전·의존성(uv), 단순성
- 구조화 로깅(JSON Lines)과 이벤트 추적: `strategy_id`, `run_id`, `order_id`, `position_id`, 체결/PNL/승률.
- 리포트 자동 생성: 백테스트/실거래 요약, 지표, 그래프(가능시).
- uv로 Python 버전·의존성 고정: 잠금파일 커밋, 재현 가능한 실행 보장. 파괴적 변경은 SemVer 준수와 마이그레이션 노트 제공.
- 단순한 데이터/계약 모델 준수: Candle(OHLCV), Signal, Order, Fill, Position, Portfolio.

## 추가 제약 및 기술 표준

- 언어/런타임: Python 3.11+.
- 의존성·버전 관리: uv 사용, 잠금파일 커밋으로 재현성 보장.
- 네트워크: Upbit REST/웹소켓 지원. 속도 제한 준수 및 재시도/백오프 표준화.
- 시간/타임존: 기본 `Asia/Seoul`, UTC 변환 명확화. 클럭 드리프트 방지.
- 데이터: 원시 틱/캔들 캐시는 `data/`에 저장, 데이터 스냅샷에 버전 태그 부여.
- 보안: API 키는 환경변수/OS 키체인 사용, 평문 커밋 금지. `.env`는 예시만 커밋.
- 구성: `config/`에 예시 템플릿 제공; 전략 파라미터는 선언적 스키마(JSON Schema/TOML)로 정의.
- 동시성: 실시간 모듈은 비동기(asyncio) 우선, I/O 경계 명시.
- 테스트 데이터: 샘플 데이터셋 제공, CI에서 빠른 단위테스트와 느린 통합테스트를 구분 실행.

## 개발 워크플로우와 품질 게이트

- 브랜치/PR: 작업은 feature 브랜치로 진행, PR 시 체크리스트로 헌장 준수 확인.
- 테스트: 단위테스트(전략/리스크/데이터 변환), 통합테스트(브로커/실시간). 백테스트-실거래 동등성 테스트 포함.
- 코드 품질: 타입 힌트 권장, 포맷터/린터(예: black/ruff) 권장, CI에서 최소 테스트 실행.
- 릴리스: SemVer 태깅, 변경 로그, 전략/데이터/리포트 호환성 표기.
- CLI UX: 한국어 메시지 허용, 로그 키/계약은 영문 스네이크케이스 유지.

## 거버넌스

- 본 헌장은 다른 관행보다 우선한다. 위배 시 변경 사유와 영향 분석을 문서화하고 PR에서 명시한다.
- 헌장 변경은 제안서, 리뷰, 버전 갱신, 마이그레이션 계획을 포함해야 한다.
- 모든 PR은 백테스트 재현성, 리스크 제어, 로깅/보고, uv 잠금파일 무결성 등을 확인한다.

**Version**: 1.0.0 | **Ratified**: 2025-10-26 | **Last Amended**: 2025-10-26
